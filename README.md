# Subspace Inference for Bayesian Deep Learning

This package aims to generate the subspace and subspace inferences.

The subspace can be generated by using the following commands:
```	using SubspaceInference
	W_swa,P = subspace_construction(model, shape, cost, data, opt, callback;T = 10, Î· = 0.1, c = 1, M = 2, svd_len = 1)
```

This work is implemented by referring the folloing publication:

*Izmailov, P., Maddox, W. J., Kirichenko, P., Garipov, T., Vetrov, D., & Wilson, A. G. (2020, August). Subspace
  inference for Bayesian deep learning. In Uncertainty in Artificial Intelligence (pp. 1169-1179). PMLR.*

## Subspace Construction
### Input Arguments
- `model` : Machine learning model. Eg: Chain(Dense(10,2)). Model should be created with Chain in Flux
- `shape` : Shape of the neural network layer. Eg: shape =[((2,10),2)] based on above model. The type of shape should be Array{Tuple{Tuple{Int64,Int64},Int64},1}
- `cost` : Cost function. Eg: L(x, y) = Flux.Losses.mse(m(x), y)
- `data` : Inputs and outputs. Eg:	X = rand(10); Y = rand(2); data = Iterators.repeated((X,Y),100);
- `opt`	: Optimzer. Eg: opt = ADAM(0.1)
- `callback` : Callback function during training. Eg: callback() = @show(L(X,Y))

### Keyword Arguments
- `T` : Number of steps for subspace calculation. Eg: T= 1
- `c` : Moment update frequency. Eg: c = 1
- `M` : Maximum number of columns in deviation matrix. Eg: M= 2
- `svd_len`: Number of columns in right singukar vectors during SVD. Eg; svd_len = 1

### Outputs
- `W_swa`: Mean weights
- `P` : Projection Matrix


### Example
```julia
using SubspaceInference
using Flux
using Flux: @epochs

M = 10
N = 15
O = 2

shape =[((2,M),O)]

X = rand(M) #input
Y = rand(O) #output 

data = Iterators.repeated((X,Y),N)

m = Chain(Dense(M, O)) #model

L(x, y) = Flux.Losses.mse(m(x), y) #cost function


ps = Flux.params(m) #model parameters

opt = ADAM(0.1) #optimizer

callback() = @show(L(X,Y)) #callback function

@epochs 1 Flux.train!(L, ps, data, opt, cb = () -> callback()) #training

W_swa,P = subspace_construction(m, shape, L, data, opt, callback)


```